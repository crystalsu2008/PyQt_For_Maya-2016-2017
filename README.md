# PyQt for Maya-2016-2017
&emsp; This is my practice for learning Mike Cole's tutorial, the ["Advanced PyQt for Maya"](https://app.pluralsight.com/library/courses/advanced-pyqt-maya-2122/table-of-contents). The tutorial used Maya 2015 and `PyQt4`. But I worked under Maya 2016 and `PySide`, I even want to use Maya 2017. The Maya 2017 came with a big change, PyQt4 and PySide no longer works with this version of Maya. Maya now uses `Qt5` and `PySide2`. And I also try to use the Qt-Designer to build my UI.

&emsp; So in this practices, I'm going to try to convert the original scripts to some compatible scripts that can be compatible with `PyQt4`, `PySide` and `PySide2`. And I will replace the hand-craft UI code with the .ui file that generated by Qt-Designer. I hope that it can be performed on any version of Maya with no issues.

&emsp; Here is a very useful guide to help convert Maya PySide script to PySide2 script, [Dealing with Maya 2017 and PySide2](https://fredrikaverpil.github.io/2016/07/25/dealing-with-maya-2017-and-pyside2/). It's form Fredrik's Blog, thanks a lot.

### PyQt, PySide in Maya 2014 and before
&emsp; I often use three versions of Maya. Those are Maya 2014, Maya 2016 and Maya 2017. The PySide, PyQt, and shiboken modules are not distributed with Maya 2014 and before versions, and must be installed separately.

&emsp; I work on 64-bit Windows 10 and [Python 2.7.12(64-bit)](https://www.python.org/downloads/release/python-2712/). So I just need to download and install the Windows 64-bit Installer, [PyQt4-4.11.4-gpl-Py2.7-Qt4.8.7-x64.exe](https://riverbankcomputing.com/software/pyqt/download) , no need to build and install SIP or build PyQt4.

>I also work with Maya 2013, but Maya 2013 uses [Python 2.6](https://www.python.org/download/releases/2.6.6/)(Since Maya 2014 they use Python 2.7). So I installed the Python 2.6 and [PyQt4-4.10-Py2.6](https://sourceforge.net/projects/pyqt/files/PyQt4/PyQt-4.10/). When I try to import PyQt4.QtCore and PyQt4.QtGui in the Maya Script Editor, I get the following error:
```python
import PyQt4.QtCore
# Error: ImportError: file <maya console> line 1: DLL load failed: The specified procedure could not be found. #
```
But it can be imported in the Python command line or IDLE with no problem. I don't know why it doesn't work on Maya, maybe I should build and install SIP and PyQt4. If anyone knows how to fix it, please tell me.

### The differences between different versions
__QtWidgets!?__
<br>There is a very important change in Qt5, a bunch of stuff was taken out from `QtGui` and instead placed in the new `QtWidgets` module. All widgets are now created from `QtWidgets`. So in Maya 2017 and Pyside2, you need not only `import QtGui` but `import QtWidgets`.
For keep the maximum compatibility with all versions, I change the import code to this:
{% highlight py %}
from pymel import versions
try: versions.v2017
except: versions.v2017 = 201700
try: versions.v2015
except: versions.v2015 = 201500

if versions.current() >= versions.v2017:
    import PySide2.QtCore    as qc
    import PySide2.QtWidgets as qw
    import PySide2.QtGui     as qg
    if Dir not in sys.path:
        sys.path.append(Dir)
    import PraLib.utils.generic as generic;reload(generic)
    from PraLib.utils.generic import loadUiType
elif versions.current() >= versions.v2015:
    import PySide.QtCore     as qc
    import PySide.QtGui      as qw
    import PySide.QtGui      as qg
    if Dir not in sys.path:
        sys.path.append(Dir)
    import PraLib.utils.generic as generic;reload(generic)
    from PraLib.utils.generic import loadUiType
else:
    if PyQt4Dir not in sys.path:
        sys.path.append(PyQt4Dir)
    import PyQt4.QtCore      as qc
    import PyQt4.QtGui       as qw
    import PyQt4.QtGui       as qg
    from PyQt4.uic import loadUiType
{% endhighlight %}
&emsp;I import `QtGui` as `qg` and import `QtWidgets` as `qw`. Since there is no `QtWidgets` module in the `PySide` or `PyQt`, I double import the `QtGui` module to make sure the maximum compatibility.

<br>__QButtonGroup__
<small><small><br>PySide.QtGui.QButtonGroup (Python class, in QButtonGroup)
<br>PySide2.QtWidgets.QButtonGroup (Python class, in QButtonGroup)</small></small>
<br>I don't know why there is a problem when I use the Qt Designer to add a `QButtongroup` for some `QRadioButton` radio buttons.
It's will send a error like this:
```
# Error: 'str' object has no attribute 'string'
# Traceback (most recent call last):
#   File "<maya console>", line 6, in <module>
#   File "C:/Users/Administrator/Documents/DEV/PyQt_To_Maya-2016-2017\SimpleUI.py", line 42, in <module>
#     form_class, base_class = loadUiType(ui_filename)
#   File "C:/Users/Administrator/Documents/DEV/PyQt_To_Maya-2016-2017\PraLib\utils\generic.py", line 58, in loadUiType
#     pyuic.compileUi(f, o, indent=0)
#   File "D:\Program Files\Autodesk\Maya2017\Python\lib\site-packages\pyside2uic\__init__.py", line 142, in compileUi
#     winfo = compiler.UICompiler().compileUi(uifile, pyfile, from_imports)
#   File "D:\Program Files\Autodesk\Maya2017\Python\lib\site-packages\pyside2uic\Compiler\compiler.py", line 91, in compileUi
#     w = self.parse(input_stream)
#   File "D:\Program Files\Autodesk\Maya2017\Python\lib\site-packages\pyside2uic\uiparser.py", line 869, in parse
#     actor(elem)
.
.
.
#   File "D:\Program Files\Autodesk\Maya2017\Python\lib\site-packages\pyside2uic\uiparser.py", line 214, in createWidget
#     bg_name = bg_i18n.string
# AttributeError: 'str' object has no attribute 'string' #
```
It seem to lead to some problems in the `pyside2uic` module. But It can be created by hand. For example:<br>
{% highlight py %}
self.button_grp_1 = qw.QButtonGroup(self)
self.button_grp_2 = qw.QButtonGroup(self)

self.button_grp_1.addButton(self.a_radio)
self.button_grp_1.addButton(self.b_radio)

self.button_grp_2.addButton(self.c_radio)
self.button_grp_2.addButton(self.d_radio)

self.button_grp_1.buttonClicked.connect(self.addToTextEdit)
{% endhighlight %}
Be careful that in the `PySide2` the `QButtonGroup` function was no longer from `QtGui` but from `QtWidgets` .

<br>__QRegExpValidator__
<small><small><br>PySide.QtGui.QRegExpValidator (Python class, in QRegExpValidator)
<br>PySide2.QtGui.QRegExpValidator (Python class, in QRegExpValidator)</small></small>
<br>Whether in the `Qt4` or `Qt5`, the `QRegExpValidator` is from the `QtGui` module.

<br>__setButtonSymbols__
<br>`QSpinBox.setButtonSymbols(0)` will send an error if you used PySide or PySide2, But it runs in PyQt4 without error.
<div class="message">
PySide.QtGui.QAbstractSpinBox.setButtonSymbols(bs)
<br>Parameters: bs â€“ PySide.QtGui.QAbstractSpinBox.ButtonSymbols:
<br>QAbstractSpinBox.UpDownArrows
<br>QAbstractSpinBox.PlusMinus
<br>QAbstractSpinBox.NoButtons
</div>
The `PySide.QtGui.QAbstractSpinBox.ButtonSymbols` type parameters must be used in `PySide` or `PySide2`. It can't just use `0`, `1` or `2`.
For example:<br>
`QSpinBox.setButtonSymbols(qg.QAbstractSpinBox.NoButtons)`

If you use the Qt Designer to create the UI, you'd better set the ButtonSymbols in the Qt Designer.
<br>`QSpinBox -> QAbstractSpinBox -> buttonSymbols`

<br>.<br>.<br>.
